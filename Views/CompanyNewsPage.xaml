<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:AMK.Models.Headlines"
             x:Class="AMK.Views.CompanyNewsPage"
             x:Name="ThisPage"
             Title="Новости компании">

    <Grid Padding="16" RowDefinitions="Auto,*">

        <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,16" ColumnSpacing="12">
            <Label Text="Новости компании" FontSize="20" FontAttributes="Bold" Grid.Column="0" VerticalOptions="Center" />
            <Button Grid.Column="1"
                    Text="+"
                    Style="{StaticResource PrimaryButton}"
                    Command="{Binding OpenAdminCommand}"
                    IsVisible="{Binding IsAdmin}" />
        </Grid>

        <RefreshView Grid.Row="1" Command="{Binding LoadCommand}" IsRefreshing="{Binding IsLoading}">
            <CollectionView ItemsSource="{Binding Items}"
                            SelectionMode="None">

                <CollectionView.EmptyView>
                    <VerticalStackLayout Padding="24" Spacing="10" HorizontalOptions="Center" VerticalOptions="Center">
                        <Label Text="Новостей пока нет" FontSize="16" />
                        <Label Text="Здесь будут новости компании" FontSize="13" TextColor="{StaticResource Gray500}" />
                    </VerticalStackLayout>
                </CollectionView.EmptyView>

                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:News">
                        <Frame Style="{StaticResource CardFrame}" Padding="14" Margin="0,0,0,12">
                            <Grid RowDefinitions="Auto,Auto" ColumnDefinitions="*,Auto" RowSpacing="6">
                                <Label Text="{Binding Title}" FontAttributes="Bold" FontSize="16" Grid.ColumnSpan="2" />
                                <Label Grid.Row="1" Text="{Binding ShortDescription}" FontSize="13" TextColor="{StaticResource Gray600}" />
                                <Label Grid.Row="1" Grid.Column="1" Text="{Binding PublishDate, StringFormat='{0:dd.MM.yyyy}'}" FontSize="12" TextColor="{StaticResource Gray500}" HorizontalTextAlignment="End" />

                                <Grid.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding BindingContext.OpenDetailCommand, Source={x:Reference Name=ThisPage}}"
                                                          CommandParameter="{Binding ID_news}" />
                                </Grid.GestureRecognizers>
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </RefreshView>
    </Grid>
</ContentPage>
